# File Specifications (7.11)

A PDF can refer to the contents of another file by using a file specification. File specifications are described in chapter 7.11 of the PDF specification. This library provides several ways to interact with them.

Files can be linked to objects using ["associated files"](14.3-associated-files.md). This is the recommended way to retrieve file specifications for a document/page.

Once you have retrieved file specifications, you can interact with them through several methods. All of them are available on the `PrinsFrank\PdfParser\Document\Object\Decorator\FileSpecification` class.

## File specification strings (7.11.2)

The file specification string is an identifier that can either be a file name or a URL, and can be absolute and relative. It can be retrieved using the `getFileSpecificationString` method;

```php
/** @var \PrinsFrank\PdfParser\Document\Object\Decorator\FileSpecification $fileSpecification */

$fileSpecification->getFileSpecificationString();
```

## Embedded files (7.11.4)

Files don't necessarily have to be embedded in the PDF document. They can also be referenced/external data. If they are embedded, they can be retrieved using the `getEmbeddedFile` method;

```php
/** @var \PrinsFrank\PdfParser\Document\Object\Decorator\FileSpecification $fileSpecification */

$fileSpecification->getEmbeddedFile();
```

If this method returns `null`, it means that the file is not embedded.

### Embedded file parameters (Table 45)

Stored within an Embedded file dictionary are several parameters with information about the file:

```php
/** @var \PrinsFrank\PdfParser\Document\Object\Decorator\EmbeddedFile $embeddedFile */

$embeddedFile->getLength();
$embeddedFile->getFileSpecificInformation();
$embeddedFile->getSize();
$embeddedFile->getCreationDate();
$embeddedFile->getModificationDate();
$embeddedFile->getParams();
```

### Embedded file content

To retrieve the content of an embedded file, you can use the `getStream` method. This will return a `PrinsFrank\Stream\Stream` object, that can be used to retrieve the content of the file. It points to a position within the PDF document or a file in memory depending on if the original PDF was encrypted and had filters.

```php
/** @var \PrinsFrank\PdfParser\Document\Object\Decorator\EmbeddedFile $embeddedFile */
$embeddedFile->getStream();
```

To get the full content of the file, you can use the `toString` method. This will return the content as a string. Be aware that this will consume a lot of memory if the file is large.

```php
/** @var \PrinsFrank\PdfParser\Document\Object\Decorator\EmbeddedFile $embeddedFile */
$embeddedFile->getStream()->toString();
```

If you want to retrieve the content of the file while not increasing the memory usage by a lot, you can also read the file content in chunks. This can be done using the `read` method:

```php
/** @var \PrinsFrank\PdfParser\Document\Object\Decorator\EmbeddedFile $embeddedFile */
$fileContentStream = $embeddedFile->getStream();
const CHUNK_SIZE = 1024;
for ($i = 0; $i < $fileContentStream->getSize(); $i += CHUNK_SIZE) {
    file_put_contents('output.txt', $fileContentStream->read($i, CHUNK_SIZE), FILE_APPEND);
}
```
